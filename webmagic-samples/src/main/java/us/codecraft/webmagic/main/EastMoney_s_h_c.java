package us.codecraft.webmagic.main;

import us.codecraft.webmagic.Page;
import us.codecraft.webmagic.Request;
import us.codecraft.webmagic.Site;
import us.codecraft.webmagic.Spider;
import us.codecraft.webmagic.pipeline.ConsolePipeline;
import us.codecraft.webmagic.pipeline.FilePipeline;
import us.codecraft.webmagic.processor.PageProcessor;
import us.codecraft.webmagic.selector.JsonPathSelector;
import us.codecraft.webmagic.utils.HttpConstant;

import java.util.ArrayList;
import java.util.List;

import static java.util.Arrays.asList;

//筛选出22天里最近一天最低的非机构持仓的轻度控盘或中度控盘的股票
public class EastMoney_s_h_c implements PageProcessor {

    List<String> url2s=new ArrayList<>();

    // 部分一：抓取网站的相关配置，包括编码、抓取间隔、重试次数等
    private Site site = Site.me().setCharset("utf-8").setRetryTimes(3).setSleepTime(1000);

    @Override
    // process是定制爬虫逻辑的核心接口，在这里编写抽取逻辑
    public void process(Page page) {

        String raw = String.valueOf(new JsonPathSelector("$").selectList(page.getRawText()));
        //System.out.println(raw);
        String[] split = raw.split("\\[|\\]");
        String jsonArray="{\"data\":["+split[2].toString()+"]}";
        //System.out.println(jsonArray);

        List<String> sumJGCXD = new ArrayList<>();

        for (int i = 0; i < 22; i++) {



            List<String> strings = new JsonPathSelector("$.data["+i+"].JGCYD").selectList(jsonArray);
            sumJGCXD.addAll(strings);



        }

        String[] split1 = sumJGCXD.toString().split("\\[|\\]")[1].split(",");
        float[] fsplit1=new float[split1.length];
        for (int i = 0; i < split1.length; i++) {
            fsplit1[i]=Float.parseFloat(split1[i]);
        }


        float max=fsplit1[0];//将数组的第一个元素赋给max
        float min=fsplit1[0];//将数组的第一个元素赋给min
        for(int i=1;i<fsplit1.length;i++){//从数组的第二个元素开始赋值，依次比较
            if(fsplit1[i]>max){//如果arr[i]大于最大值，就将arr[i]赋给最大值
                max=fsplit1[i];
            }
            if(fsplit1[i]<min){//如果arr[i]小于最小值，就将arr[i]赋给最小值
                min=fsplit1[i];
            }
        }
        System.out.print(new JsonPathSelector("$.data[0].STOCKNAME").selectList(jsonArray));
        System.out.print(new JsonPathSelector("$.data[0].TRADECODE").selectList(jsonArray));
        if(fsplit1[0]==min){
            System.out.println("今天的股票有了！！！");
        }

        


        //沪市A股 1622
        //深市A股 474
        //创业板 932
        //中小板  1012









        }

    @Override
    public Site getSite() {
        return site;
    }

    public static void main(String[] args) {
        Request request = new Request();
        request.setMethod(HttpConstant.Method.GET);

        List<String> l = asList(
                "600006","600025","600052","600053","600055","600058","600059","600060","600063","600066","600071","600075","600078","600079","600088","600093","600095","600096","600097","600103","600104","600105","600110","600111","600114","600118","600121","600126","600127","600129","600131","600133","600139","600141","600143","600151","600160","600161","600163","600166","600168","600169","600172","600176","600178","600184","600185","600186","600187","600188","600189","600190","600198","600199","600212","600213","600216","600219","600220","600223","600227","600230","600233","600235","600236","600237","600239","600255","600256","600257","600259","600267","600268","600273","600277","600291","600292","600295","600297","600299","600303","600307","600310","600313","600315","600316","600320","600321","600326","600328","600331","600333","600335","600338","600339","600340","600343","600346","600352","600359","600360","600362","600366","600367","600379","600381","600382","600387","600391","600392","600393","600396","600397","600403","600405","600409","600415","600418","600419","600422","600425","600428","600429","600433","600435","600438","600439","600452","600456","600466","600469","600475","600480","600481","600483","600489","600495","600496","600497","600499","600500","600501","600503","600505","600506","600507","600516","600517","600520","600526","600529","600531","600532","600536","600537","600540","600543","600545","600546","600549","600552","600556","600559","600565","600567","600569","600576","600578","600579","600581","600583","600586","600596","600597","600602","600616","600618","600619","600623","600628","600640","600645","600653","600655","600660","600673","600678","600683","600691","600695","600704","600707","600710","600714","600719","600722","600723","600724","600726","600732","600733","600737","600740","600744","600746","600749","600751","600753","600754","600758","600759","600760","600766","600769","600771","600773","600776","600779","600780","600782","600784","600792","600793","600794","600798","600800","600802","600803","600807","600810","600818","600823","600824","600827","600834","600835","600844","600846","600850","600859","600860","600861","600862","600865","600868","600869","600874","600875","600876","600879","600880","600882","600884","600885","600888","600889","600892","600893","600896","600908","600916","600917","600956","600960","600961","600963","600969","600970","600971","600975","600976","600982","600983","600984","600985","600989","600993","600995","600997","600999","601000","601009","601011","601015","601016","601018","601020","601021","601038","601058","601068","601088","601101","601108","601117","601118","601126","601127","601137","601158","601163","601168","601198","601199","601212","601216","601218","601222","601225","601233","601238","601311","601330","601369","601375","601388","601456","601515","601588","601598","601599","601600","601609","601611","601615","601618","601619","601633","601636","601677","601678","601686","601689","601702","601717","601727","601766","601788","601799","601808","601811","601858","601865","601866","601882","601898","601908","601949","601956","601963","601965","601969","601991","601996","603000","603002","603005","603016","603025","603026","603042","603060","603063","603069","603076","603078","603079","603080","603083","603085","603098","603100","603110","603113","603116","603126","603127","603128","603129","603136","603155","603167","603169","603180","603185","603186","603187","603196","603198","603200","603208","603214","603218","603222","603233","603236","603239","603260","603267","603278","603290","603298","603299","603303","603305","603308","603318","603322","603330","603333","603338","603345","603353","603363","603366","603369","603378","603380","603392","603399","603429","603456","603486","603499","603500","603507","603517","603528","603533","603535","603557","603587","603588","603596","603598","603599","603603","603605","603607","603610","603612","603613","603616","603619","603636","603650","603655","603659","603661","603678","603680","603690","603693","603698","603700","603703","603706","603707","603708","603709","603712","603713","603718","603729","603737","603739","603776","603777","603778","603801","603806","603810","603811","603815","603817","603818","603825","603826","603839","603843","603848","603879","603881","603882","603883","603890","603893","603901","603906","603915","603916","603919","603920","603929","603931","603936","603938","603939","603976","603977","603979","603982","603983","603987","603988","603990","603993","603995","605005","605006","605007","605008","605018","605055","605060","605068","605077","605133","605136","605151","605155","605166","605168","605169","605179","605188","605198","605199","605208","605228","605255","605258","605266","605268","605277","605286","605298","605303","605337","605338","605358","605366","605376","605389","605398","605500","000005","000007","000009","000010","000011","000014","000019","000020","000025","000026","000027","000029","000030","000032","000034","000037","000039","000040","000045","000048","000049","000056","000058","000060","000065","000068","000150","000151","000155","000159","000301","000338","000400","000402","000403","000413","000415","000420","000421","000423","000428","000488","000501","000502","000503","000505","000516","000517","000519","000521","000523","000525","000526","000528","000530","000531","000533","000540","000544","000545","000550","000557","000558","000560","000561","000565","000567","000570","000573","000576","000581","000582","000584","000591","000592","000596","000600","000603","000605","000606","000607","000608","000609","000610","000612","000613","000615","000616","000617","000622","000625","000626","000631","000633","000638","000655","000657","000659","000667","000672","000676","000677","000680","000681","000688","000691","000692","000695","000697","000698","000700","000708","000710","000711","000712","000713","000716","000718","000720","000722","000723","000727","000732","000733","000738","000739","000758","000761","000762","000766","000767","000778","000782","000785","000788","000791","000793","000795","000798","000802","000803","000807","000809","000812","000813","000815","000816","000822","000828","000830","000831","000836","000838","000839","000852","000856","000859","000869","000875","000876","000877","000878","000881","000883","000889","000892","000893","000895","000898","000899","000901","000903","000908","000911","000918","000921","000922","000923","000927","000929","000931","000933","000938","000949","000951","000958","000959","000966","000969","000970","000975","000976","000977","000978","000983","000985","000987","000993","000995","000996","001914","002001","002002","002006","002008","002009","002013","002015","002017","002019","002024","002026","002028","002030","002036","002039","002044","002045","002048","002050","002054","002060","002064","002066","002067","002068","002075","002079","002080","002081","002082","002084","002088","002090","002092","002094","002096","002097","002100","002105","002107","002109","002110","002111","002114","002118","002119","002123","002124","002125","002127","002130","002132","002136","002139","002142","002145","002148","002149","002152","002156","002157","002158","002160","002161","002162","002164","002169","002172","002173","002174","002177","002178","002180","002181","002183","002184","002189","002190","002195","002196","002197","002199","002201","002202","002205","002206","002207","002212","002216","002218","002221","002234","002235","002237","002239","002241","002242","002245","002249","002251","002254","002263","002268","002269","002272","002279","002283","002286","002287","002291","002294","002297","002303","002305","002308","002309","002311","002312","002315","002316","002318","002319","002321","002328","002329","002331","002334","002335","002338","002341","002342","002343","002351","002358","002360","002364","002366","002368","002369","002370","002372","002374","002375","002378","002379","002382","002383","002387","002390","002397","002401","002402","002405","002407","002408","002411","002413","002416","002419","002422","002424","002425","002429","002430","002434","002435","002439","002442","002444","002452","002455","002458","002462","002464","002468","002471","002474","002478","002480","002484","002485","002486","002487","002488","002490","002493","002494","002497","002498","002503","002504","002505","002506","002507","002508","002510","002512","002514","002516","002517","002518","002521","002530","002531","002532","002534","002536","002537","002541","002548","002549","002550","002553","002554","002557","002562","002564","002567","002568","002570","002571","002572","002576","002578","002584","002585","002588","002591","002596","002597","002603","002606","002607","002608","002609","002610","002611","002612","002614","002617","002619","002620","002625","002630","002633","002634","002636","002640","002642","002645","002646","002647","002648","002651","002652","002653","002654","002657","002658","002662","002663","002665","002668","002670","002673","002674","002675","002677","002679","002683","002685","002688","002689","002691","002693","002695","002696","002699","002702","002703","002706","002707","002708","002709","002712","002713","002715","002721","002725","002727","002730","002731","002738","002740","002743","002747","002756","002759","002765","002769","002776","002777","002781","002782","002790","002791","002795","002799","002805","002810","002813","002816","002819","002822","002824","002825","002828","002833","002836","002837","002841","002846","002847","002850","002852","002853","002859","002862","002863","002867","002873","002875","002881","002885","002886","002887","002890","002892","002893","002900","002905","002906","002907","002908","002910","002911","002915","002916","002920","002928","002931","002932","002940","002941","002943","002946","002948","002949","002953","002955","002956","002959","002960","002961","002962","002968","002969","002971","002975","002977","002979","002980","002981","002983","002984","002988","002993","002996","002997","002998","002999","003000","003001","003002","003003","003004","003006","003007","003009","003010","003011","003012","003015","003016","003018","003019","003022","003025","003027","003028","003029","003030","003031","003032","003033","003035","003037","003038","003039","300004","300010","300022","300025","300062","300071","300082","300102","300105","300106","300120","300140","300141","300152","300157","300159","300161","300169","300178","300179","300189","300192","300205","300208","300211","300234","300269","300276","300277","300278","300283","300289","300293","300297","300305","300307","300309","300312","300313","300336","300337","300340","300343","300344","300356","300357","300368","300369","300374","300380","300385","300402","300410","300417","300426","300458","300459","300461","300465","300489","300500","300506","300537","300543","300546","300548","300549","300561","300573","300581","300582","300591","300595","300613","300621","300629","300636","300641","300670","300675","300689","300697","300713","300727","300731","300733","300740","300742","300752","300762","300781","300798","300812","300819","300820","300827","300839","300842","300846","300848","300859","300863","300864","300879","300881","300882","300886","300889","300890","300891","300893","300898","300899","300901","300906","300907","300912","300917","300918","300922","300923","300927","300929","300931","300933","300937","300940","300945","300946","300948","300950");
        List<String> urls = new ArrayList<>();
        for (String t:l){
            StringBuilder s=new StringBuilder("http://dcfm.eastmoney.com/em_mutisvcexpandinterface/api/js/get?type=QGQP_LSJGCYD&token=70f12f2f4f091e459a279469fe49eca5&ps=22&filter=(TRADECODE=%27");
            s.append(t);
            s.append("%27)&st=TRADEDATE&sr=-1&callback=jQuery112307965527139220383_1617014060178&_=1617014060179");
            System.out.println(s);
            request.setUrl(s.toString());

            Spider.create(new EastMoney_s_h_c())
                    //从"https://github.com/code4craft"开始抓
                    .addRequest(request)
                    .addPipeline(new FilePipeline("D:/data"))
                    .addPipeline(new ConsolePipeline())
                    //开启5个线程抓取
                    .thread(20)
                    //启动爬虫
                    .run();

        }
    }
}
